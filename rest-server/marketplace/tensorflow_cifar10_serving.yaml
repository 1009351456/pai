prerequisites : 
  - protocol_version : v2
    name : cifar10_model
    type : data
    version : x.y.z
    contributor : xxx
    description: cifar10 model, image classification
    uri : [ hdfs://xxx/cifar10_model ]
  - protocol_version : v2
    name : tf_serving_example
    type : dockerimage
    version : x.y.z
    contributor : xxx
    description: python3.5, tensorflow
    uri : openpai/pai.example.tensorflow-serving

job : 
  protocol_version: v2
  name : cifar10_tensorflow_serving
  type : job
  version : x.y.z
  contributor : xxx
  description : image classification, cifar10 dataset, tensorflow, serving
  parameters :
    portList : [ { label: model_server, beginAt: 0, portNumber: 1 } ]
    num_of_worker: 1
    retryCount: 1 

  tasks :
    - name : worker
      data : cifar10_model
      dockerimage : tf_serving_example
      resource: 
        instances : $job.parameters.num_of_worker
        resoucePerInstance: {cpu: 4, memoryMB: 8192, gpu: 1}
      env:
        PYTHONPATH : $job.tasks.worker.script/scripts/tf_cnn_benchmarks
      command:
        - while :; do tensorflow_model_server --port=$PAI_CONTAINER_HOST_model_server_PORT_LIST --model_name=cifar10 --model_base_path=cifar10_model; done